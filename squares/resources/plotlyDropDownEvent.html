<div class="row mt-2">
  <div class="col-lg-10">
    <div class="showcase__section" id="bubble">
      <div id="bubbleplots">
        <div class="bubbleplot" data-num="0">
          <div class="plot" id="plotdiv"></div>
          <div class="control-row">
            Country: <select class="countrydata">
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- sidebar -->
  <div class="col-lg-2">
    <div class="sidebar-section px-1">
      <div class="text-centersidebar-section  py-0 mt-0">
        <img class="img-fluid mt-0 mb-1" alt="sidebar top img"
          src="https://raw.githubusercontent.com/attila5287/displayTracker_img/master/general/sidebar_denver_realPhoto.png"
          style="height: 8rem;">
      </div>
      <button type="button"
        class="btn btn-danger btn-lg btn-block disabled sidebar-section border-success py-1 mb-0 mt-1">
        <i class="fas fa-map-signs"></i>
        Site Map
      </button>
      <div class="list-group sidebar-section text-center mt-1 mb-0" style="border-radius: 4px;">
        <a href="/register" class="list-group-item list-group-item-action">
          <i class="fas fa-registered    "></i>
          Register
        </a>
        <a href="/login" class="list-group-item list-group-item-action">
          <i class="fas fa-sign-in-alt"></i>
          Login
        </a>
        <a href="/about" class="list-group-item list-group-item-action">
          <i class="fas fa-info-circle"></i>
          About
        </a>
      </div>
      <div class="text-center py-0">
        <img class="img-fluid mb-2 mt-0" alt="sidebar bottom img"
          src="https://raw.githubusercontent.com/attila5287/displayTracker_img/master/general/sidebar_bottom_waves05.png"
          style="height: 7rem;">
      </div>

    </div>
  </div>
</div>
<script>
Plotly.d3.csv('https://raw.githubusercontent.com/plotly/datasets/master/gapminderDataFiveYear.csv', function(err, rows){

    function unpack(rows, key) {
        return rows.map(function(row) { return row[key]; });
    }

var allCountryNames = unpack(rows, 'country'),
    allYear = unpack(rows, 'year'),
    allGdp = unpack(rows, 'gdpPercap'),
    listofCountries = [],
    currentCountry,
    currentGdp = [],
    currentYear = [];

  for (var i = 0; i < allCountryNames.length; i++ ){
    if (listofCountries.indexOf(allCountryNames[i]) === -1 ){
      listofCountries.push(allCountryNames[i]);
    }
  }
  
  function getCountryData(chosenCountry) {
    currentGdp = [];
    currentYear = [];
    for (var i = 0 ; i < allCountryNames.length ; i++){
      if ( allCountryNames[i] === chosenCountry ) {
        currentGdp.push(allGdp[i]);
        currentYear.push(allYear[i]);
      } 
    }
  };

// Default Country Data
setBubblePlot('Afghanistan');
   
function setBubblePlot(chosenCountry) {
    getCountryData(chosenCountry);  

    var trace1 = {
      x: currentYear,
      y: currentGdp,
      mode: 'lines+markers',
      marker: {
        size: 12, 
        opacity: 0.5
      }
    };

    var data = [trace1];

    var layout = {
      title: 'GDP per cap according to Country<br>'+ chosenCountry + ' GDP'
    };

    Plotly.newPlot('plotdiv', data, layout, {showSendToCloud: true});
};
  
var innerContainer = document.querySelector('[data-num="0"'),
    plotEl = innerContainer.querySelector('.plot'),
    countrySelector = innerContainer.querySelector('.countrydata');

function assignOptions(textArray, selector) {
  for (var i = 0; i < textArray.length;  i++) {
      var currentOption = document.createElement('option');
      currentOption.text = textArray[i];
      selector.appendChild(currentOption);
  }
}

assignOptions(listofCountries, countrySelector);

function updateCountry(){
    setBubblePlot(countrySelector.value);
}
  
countrySelector.addEventListener('change', updateCountry, false);
});
</script>
